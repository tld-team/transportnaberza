<?php
class DataTables_Cargo_Shortcode extends TLD_Cargo_Database_Handler{
    public function __construct() {
        add_shortcode('datatable_cargo', array($this, 'generate_datatable_shortcode'));

    }

    public function generate_datatable_shortcode($atts) {
        // Izlazni HTML
?>
        <table id="example" class="display">
            <thead>
                <tr>
                    <th><?php echo $this->svg_calendar(); ?></th>
                    <th>Mesto Utovara</th>
                    <th><?php echo $this->svg_calendar(); ?></th>
                    <th>Mesto Istovara</th>
                    <th>KM</th>
                    <th>Tip Vozila</th>
                    <th>Nadogradnja</th>
                    <th><?php echo $this->svg_cargo_data(); ?></th>
                </tr>
            </thead>
            <tfoot>
                <tr>
                    <th><?php echo $this->svg_calendar(); ?></th>
                    <th>Mesto Utovara</th>
                    <th><?php echo $this->svg_calendar(); ?></th>
                    <th>Mesto Istovara</th>
                    <th>KM</th>
                    <th>Tip Vozila</th>
                    <th>Nadogradnja</th>
                    <th><?php echo $this->svg_cargo_data(); ?></th>
                </tr>
            </tfoot>
        </table>
        <?php

        // Dodajte inline JavaScript u footer
        add_action('wp_footer', array($this, 'add_inline_script'), 100);

    }

    public function add_inline_script() {
        $imported_data = $this->get_extended_record_by_date(12);
        ?>
        <script type="text/javascript">
        // Formatting function for row details - modify as you need
        function format(d) {
            // `d` is the original data object for the row
            return (
                '<dl>' +
                '<dt>Full name:</dt>' +
                '<dd>' +
                d.location_to +
                '</dd>' +
                '<dt>Extension number:</dt>' +
                '<dd>' +
                d.vehicle_type +
                '</dd>' +
                '<dt>Extra info:</dt>' +
                '<dd>And any further details here (images etc)...</dd>' +
                '</dl>'
            );
        }
        
        jQuery(document).ready(function($) {
            let table = new DataTable('#example', {
                data: <?php echo $imported_data; ?>,
                columns: [
                    { 
                        data: 'date_from',
                        className: 'dt-control2',
                        defaultContent: ''
                     },
                    { 
                        data: 'location_from',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'date_to',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'location_to',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'vehicle_type',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'trailer',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'country_from',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                    { 
                        data: 'country_to',
                        className: 'dt-control2',                        
                        defaultContent: ''
                     },
                ],
                order: [[1, 'asc']]
            });
            
            // Add event listener for opening and closing details
            table.on('click', 'tbody td.dt-control2', function (e) {
                let tr = e.target.closest('tr');
                let row = table.row(tr);
            
                if (row.child.isShown()) {
                    // This row is already open - close it
                    row.child.hide();
                }
                else {
                    // Open this row
                    row.child(format(row.data())).show();
                }
            });
        });
        </script>
        <?php
    }

    public function svg_calendar () {
        ?>
        <svg width="20" height="20s" viewBox="0 0 15 15" fill="none" xmlns="http://www.w3.org/2000/svg">
<path d="M12.162 1.0005C13.6455 1.0005 14.418 1.7655 14.418 3.228V11.5485C14.418 13.011 13.6455 13.776 12.162 13.776H2.7495C1.272 13.776 0.4995 13.011 0.4995 11.5485V3.228C0.4995 1.7595 1.272 1.0005 2.7495 1.0005H12.162ZM12.1695 4.3365H2.742C2.175 4.3365 1.86 4.6305 1.86 5.232V11.52C1.86 12.1215 2.175 12.4155 2.742 12.4155H12.1695C12.7365 12.4155 13.0515 12.1215 13.0515 11.52V5.232C13.0515 4.6305 12.7365 4.3365 12.1695 4.3365Z" fill="black"/>
<path opacity="0.4" d="M4.308 10.0515C4.5345 10.0515 4.6215 10.1145 4.6335 10.3185L4.635 10.3725V10.776C4.635 10.9965 4.566 11.0775 4.362 11.088L4.308 11.0895H3.9105C3.684 11.0895 3.597 11.0265 3.585 10.827L3.5835 10.776V10.3725C3.5835 10.1445 3.6525 10.0635 3.8565 10.0515H3.9105H4.308ZM6.1395 10.0515H6.543C6.7695 10.0515 6.858 10.1145 6.87 10.3185L6.8715 10.3725V10.776C6.8715 10.9965 6.801 11.0775 6.597 11.088L6.543 11.0895H6.1395C5.913 11.0895 5.8245 11.0265 5.8125 10.827L5.811 10.776V10.3725C5.811 10.1445 5.8815 10.0635 6.0855 10.0515H6.1395ZM8.778 10.0515C9.018 10.0515 9.099 10.1265 9.099 10.3725V10.776C9.099 11.0145 9.018 11.0895 8.778 11.0895H8.3745C8.1285 11.0895 8.0475 11.0145 8.0475 10.776V10.3725C8.0475 10.1265 8.1285 10.0515 8.3745 10.0515H8.778ZM4.308 7.857C4.5345 7.857 4.6215 7.92 4.6335 8.118L4.635 8.1705V8.574C4.635 8.802 4.566 8.883 4.362 8.8935L4.308 8.895H3.9105C3.684 8.895 3.597 8.832 3.585 8.628L3.5835 8.574V8.1705C3.5835 7.95 3.6525 7.869 3.8565 7.8585L3.9105 7.857H4.308ZM6.543 7.857C6.7695 7.857 6.858 7.92 6.87 8.118L6.8715 8.1705V8.574C6.8715 8.802 6.801 8.883 6.597 8.8935L6.543 8.895H6.1395C5.913 8.895 5.8245 8.832 5.8125 8.628L5.811 8.574V8.1705C5.811 7.95 5.8815 7.869 6.0855 7.8585L6.1395 7.857H6.543ZM8.778 7.857C8.9985 7.857 9.0855 7.92 9.0975 8.118L9.099 8.1705V8.574C9.099 8.802 9.03 8.883 8.8305 8.8935L8.778 8.895H8.3745C8.148 8.895 8.061 8.832 8.049 8.628L8.0475 8.574V8.1705C8.0475 7.95 8.1165 7.869 8.3205 7.8585L8.3745 7.857H8.778ZM11.007 7.857C11.2335 7.857 11.322 7.92 11.334 8.118L11.3355 8.1705V8.574C11.3355 8.802 11.265 8.883 11.061 8.8935L11.007 8.895H10.6035C10.383 8.895 10.296 8.832 10.284 8.628L10.2825 8.574V8.1705C10.2825 7.95 10.3515 7.869 10.551 7.8585L10.6035 7.857H11.007ZM6.543 5.655C6.7695 5.655 6.858 5.7195 6.87 5.9235L6.8715 5.976V6.3795C6.8715 6.6 6.801 6.6825 6.597 6.693L6.543 6.6945H6.1395C5.913 6.6945 5.8245 6.63 5.8125 6.432L5.811 6.3795V5.976C5.811 5.7495 5.8815 5.6685 6.0855 5.6565L6.1395 5.655H6.543ZM8.778 5.655C8.9985 5.655 9.0855 5.7195 9.0975 5.9235L9.099 5.976V6.3795C9.099 6.6 9.03 6.6825 8.8305 6.693L8.778 6.6945H8.3745C8.148 6.6945 8.061 6.63 8.049 6.432L8.0475 6.3795V5.976C8.0475 5.7495 8.1165 5.6685 8.3205 5.6565L8.3745 5.655H8.778ZM11.007 5.655C11.2335 5.655 11.322 5.7195 11.334 5.9235L11.3355 5.976V6.3795C11.3355 6.6 11.265 6.6825 11.061 6.693L11.007 6.6945H10.6035C10.383 6.6945 10.296 6.63 10.284 6.432L10.2825 6.3795V5.976C10.2825 5.7495 10.3515 5.6685 10.551 5.6565L10.6035 5.655H11.007Z" fill="black"/>
</svg>
    <?php
    }   
    public function svg_cargo_data () {
        ?>
        <svg width="89" height="31" viewBox="0 0 89 31" fill="none" xmlns="http://www.w3.org/2000/svg">
    <rect width="89" height="30.5455" fill="white" fill-opacity="0.1"/>
    <path d="M16.551 15.1877H17.745C18.018 15.1877 18.24 14.9758 18.24 14.7152V8.74454C18.24 8.48395 18.018 8.27491 17.745 8.27491H16.551C16.278 8.27491 16.056 8.48395 16.056 8.74454V14.7152C16.056 14.9758 16.278 15.1877 16.551 15.1877ZM35.82 8H34.623C34.353 8 34.131 8.21191 34.131 8.46964V10.3883C34.131 10.6489 33.912 10.8608 33.639 10.8608H21.417C21.144 10.8608 20.922 10.6489 20.922 10.3883V8.74454C20.922 8.48395 20.703 8.27491 20.43 8.27491H19.233C18.96 8.27491 18.741 8.48395 18.741 8.74454V14.7152C18.741 14.9758 18.96 15.1877 19.233 15.1877H20.43C20.703 15.1877 20.922 14.9758 20.922 14.7152V12.5217C20.922 12.264 21.144 12.052 21.417 12.052H33.639C33.912 12.052 34.131 12.264 34.131 12.5217V14.4432C34.131 14.7009 34.353 14.9128 34.623 14.9128H35.82C36.093 14.9128 36.315 14.7009 36.315 14.4432V8.46964C36.315 8.21191 36.093 8 35.82 8ZM38.508 8H37.311C37.038 8 36.816 8.21191 36.816 8.46964V14.4432C36.816 14.7009 37.038 14.9128 37.311 14.9128H38.508C38.778 14.9128 39 14.7009 39 14.4432V8.46964C39 8.21191 38.778 8 38.508 8ZM10.686 15.351L9.48903 15.3595C9.21603 15.3624 8.99703 15.5743 9.00003 15.8349L9.05703 21.8085C9.06003 22.0662 9.28203 22.2752 9.55503 22.2724L10.752 22.2638C11.025 22.2609 11.241 22.049 11.241 21.7884L11.184 15.8177C11.181 15.5571 10.959 15.3481 10.686 15.351ZM28.755 14.9214L27.561 14.93C27.288 14.9329 27.069 15.1448 27.072 15.4054L27.09 17.324C27.093 17.5846 26.874 17.7965 26.601 17.7994L14.379 17.9025C14.106 17.9053 13.884 17.6963 13.881 17.4385L13.866 15.792C13.863 15.5342 13.641 15.3252 13.368 15.328L12.174 15.3366C11.901 15.3395 11.682 15.5514 11.685 15.812L11.739 21.7855C11.742 22.0461 11.964 22.2523 12.237 22.2523L13.434 22.2409C13.704 22.238 13.923 22.0261 13.92 21.7655L13.902 19.572C13.899 19.3114 14.118 19.0995 14.391 19.0966L26.613 18.9906C26.886 18.9878 27.108 19.1968 27.111 19.4574L27.126 21.3789C27.129 21.6366 27.351 21.8457 27.624 21.8428L28.824 21.8342C29.097 21.8314 29.313 21.6195 29.313 21.3589L29.253 15.3882C29.25 15.1276 29.028 14.9185 28.755 14.9214ZM31.443 14.8985L30.246 14.9071C29.973 14.91 29.754 15.1219 29.757 15.3825L29.814 21.3531C29.817 21.6137 30.039 21.8228 30.312 21.8199L31.506 21.8113C31.779 21.8085 31.998 21.5965 31.995 21.336L31.941 15.3653C31.938 15.1047 31.716 14.8956 31.443 14.8985Z" fill="#070707"/>
    <path d="M51 28.6364C60.705 19.0833 70.392 9.55023 80.097 0V28.6364H51ZM64.749 23.0465H74.418V13.5307L64.749 23.0465ZM77.484 9.55596C77.355 9.36123 77.286 9.20659 77.175 9.09777C76.413 8.33604 75.642 7.58005 74.871 6.82691C74.592 6.55486 74.295 6.53482 74.061 6.76105C73.83 6.98441 73.851 7.28223 74.127 7.55714C74.544 7.97236 74.964 8.38186 75.384 8.79423C75.747 9.15218 76.11 9.51013 76.476 9.86523C76.644 10.0256 76.854 10.123 77.064 9.98836C77.223 9.891 77.331 9.71918 77.484 9.55596ZM63.513 17.2591C63.354 17.388 63.174 17.4796 63.084 17.6285C62.949 17.849 63.03 18.0724 63.219 18.2585L65.565 20.5666C65.826 20.8215 66.129 20.833 66.351 20.6125C66.567 20.4005 66.558 20.0827 66.309 19.8364C65.532 19.0632 64.749 18.2929 63.963 17.5312C63.855 17.4252 63.705 17.3708 63.513 17.2591ZM60.582 26.1794C60.732 26.0534 60.915 25.9617 61.002 25.8128C61.128 25.6038 61.056 25.3833 60.876 25.2057C60.087 24.4325 59.301 23.6536 58.509 22.8805C58.26 22.637 57.933 22.6285 57.723 22.8432C57.516 23.0523 57.519 23.3587 57.759 23.5964C58.548 24.3839 59.343 25.1656 60.144 25.9417C60.243 26.039 60.393 26.082 60.582 26.1794ZM71.946 14.7935C71.922 14.7477 71.889 14.616 71.805 14.533C70.995 13.7225 70.182 12.915 69.348 12.1275C69.237 12.0215 68.997 11.97 68.841 12.0015C68.457 12.0845 68.328 12.5456 68.613 12.832C69.417 13.6481 70.242 14.4442 71.061 15.246C71.097 15.2804 71.136 15.309 71.178 15.3319C71.535 15.5266 71.955 15.2718 71.946 14.7935ZM67.251 17.3995C67.173 17.2305 67.149 17.1045 67.074 17.0272C66.624 16.5661 66.168 16.108 65.697 15.667C65.493 15.4751 65.193 15.5009 65.001 15.6813C64.8 15.8674 64.767 16.1795 64.968 16.3886C65.415 16.8525 65.871 17.3135 66.354 17.7374C66.468 17.8376 66.738 17.8519 66.891 17.7946C67.041 17.7374 67.134 17.534 67.251 17.3995ZM72.693 12.0473C72.63 11.8927 72.612 11.7724 72.546 11.7008C72.075 11.2197 71.598 10.7415 71.106 10.2833C70.92 10.1115 70.608 10.1602 70.434 10.3349C70.248 10.521 70.206 10.8016 70.392 10.9935C70.86 11.4803 71.337 11.9557 71.841 12.4024C71.943 12.494 72.21 12.4883 72.357 12.4253C72.498 12.3623 72.588 12.1733 72.693 12.0473ZM69.066 15.5982C68.979 15.4293 68.946 15.2975 68.862 15.2116C68.424 14.7649 67.977 14.321 67.521 13.8915C67.323 13.7054 67.011 13.7168 66.819 13.8886C66.615 14.069 66.573 14.3898 66.774 14.596C67.221 15.0627 67.677 15.5238 68.163 15.9505C68.277 16.0507 68.553 16.0679 68.706 16.0077C68.859 15.9476 68.949 15.7414 69.066 15.5982ZM63.609 20.9819C63.555 20.8301 63.546 20.727 63.492 20.6697C62.997 20.1715 62.508 19.6646 61.986 19.1978C61.797 19.0289 61.53 19.0919 61.347 19.2837C61.167 19.4756 61.122 19.7247 61.308 19.9166C61.77 20.4063 62.25 20.8816 62.751 21.3312C62.856 21.4229 63.123 21.4315 63.264 21.3685C63.417 21.2969 63.507 21.0993 63.609 20.9819ZM61.797 22.7545C61.725 22.597 61.704 22.471 61.629 22.3936C61.17 21.9269 60.708 21.463 60.231 21.0162C60.024 20.8215 59.733 20.8616 59.538 21.0563C59.361 21.231 59.322 21.5345 59.496 21.7178C59.958 22.196 60.426 22.6685 60.924 23.1067C61.035 23.204 61.308 23.2069 61.461 23.1439C61.605 23.0924 61.689 22.8919 61.797 22.7545ZM72.591 8.33032C72.438 8.45346 72.258 8.54223 72.165 8.68827C72.03 8.89445 72.093 9.11782 72.273 9.29536C72.693 9.70773 73.107 10.123 73.533 10.5325C73.779 10.7673 74.082 10.7759 74.298 10.5697C74.511 10.3664 74.514 10.0456 74.283 9.81368C73.869 9.39559 73.449 8.98323 73.023 8.57945C72.921 8.48495 72.777 8.43627 72.591 8.33032Z" fill="black"/>
    <path d="M50.2216 6L45.5341 22.6232H44L48.6875 6H50.2216Z" fill="black"/>
    </svg>        
        <?php
    }
}
